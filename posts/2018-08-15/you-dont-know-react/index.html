<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="shortcut icon" href="/blog/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/blog/manifest.json"><link rel="canonical" href="/blog/posts/2018-08-15/you-dont-know-react/" />

    <title data-react-helmet="true">React 你不知道的那些事儿</title>
    
    
  <link rel="stylesheet" href="/blog/static/css/1.49edd35f.chunk.css" /><link href="/blog/static/css/main.09aff692.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__2z5VE"><div class="
        LoadingIndicator_LoadingIndicator__LI6x0
        
        undefined
      "></div><header><h3 class="BlogLayout_title__nZ4wJ"><a class=" " href="/">qingtong Blog</a></h3></header><main><article><header class="BlogPostLayout_header__hNrNi"><h1 class="BlogPostLayout_title__j9S_E"><a class=" " href="/posts/2018-08-15/you-dont-know-react/">React 你不知道的那些事儿</a></h1><small><time dateTime="Tue, 14 Aug 2018 16:00:00 GMT">August 15, 2018</time> <!-- -->•<!-- --> <ul class="ArticleMeta_tags__bwcp_"><li><a class=" " href="/tags/react/">react</a></li></ul> <!-- -->•<!-- --> <span>☕️<!-- --> <!-- -->4<!-- --> min read</span></small></header><div class="BlogPostLayout_content__3oTIu"><blockquote><p>注：本文写于 2018 年，基于 react 15 的一些实践分享，部分内容已经不太符合目前 react 16 的架构，请谨慎采纳</p></blockquote><p><img src="https://github.com/wulucxy/blog/raw/master/src/routes/posts/2018-08-15-you-dont-know-react/image/graphic.png" alt="react-graphic"/></p><p>React 上手很简单，初次接触 React 的同学花半天时间差不多就能看完 React 官网文档。但要真正掌握 React 是一个漫长的过程，React 真正的威力在于其背后庞大繁荣的生态圈，redux、react-router、mobX、create-react-app、GraphQL 等，你要学习的不是一个库，也不是一个框架，而是一整套技术栈，和完整的 React 的思维方式。 </p><p>本文不介绍 React 基础知识，也不介绍 React 库 的具体用法，我会分享一些 React 实战开发中的 ”令人眼前一亮“ 的案例，希望能够对你有一定的启发。当然如果你有更好的 case 分享，欢迎评论。</p><h3 id="1-component">1. Component</h3><p>React 有三种组件构建方式：</p><ul><li>React.Component</li><li>React.pureComponent</li><li>stateless Component</li></ul><p>这三种组件区别可以参考 <a class=" " href="https://reactjs.org/docs/components-and-props.html">官方文档</a>，这里要聊得是如何选择组件类型：</p><p>通常我们可以按照以下逻辑来确定组件应用场景：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">if</span> <span class="token punctuation">(</span>componentHasNoState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 1. 如果组件不需要维护应用状态，选择 stateless Component</span>
 <span class="token keyword">return</span> <span class="token function">itsStatelessComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>componentHasSimplePropsState <span class="token operator">&amp;&amp;</span> propsHasNoNestedObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 2. 如果组件属性简单，并且不含有嵌套数据，选择 pureComponent</span>
 <span class="token keyword">return</span> <span class="token function">itsPureComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
 <span class="token comment">// 3. 其他情况选择 Component</span>
 <span class="token keyword">return</span> <span class="token function">itsComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><blockquote><p>补充：</p><p>React.pureComponent 对于高响应组件（Input 等）也不建议使用，每次比较props有性能消耗。</p></blockquote><h3 id="2-refs">2. refs</h3><p>React 通过声明式的渲染机制把复杂 DOM 操作简化为 state 和 props 操作，但某些特场景，我们仍然离不开 DOM 操作和跨组件调用，React 开放了 ref 属性可以方便我们操作 DOM 和 调用其他组件实例。</p><p>React <a class=" " href="https://reactjs.org/docs/refs-and-the-dom.html">创建 ref 有三种方式</a>：</p><ul><li>string 类型 ref - <strong>deprecated，不推荐使用</strong></li><li>callback ref - 推荐使用</li><li>React.createRef() - <strong>React 16 后添加，推荐使用</strong></li></ul><p>ref 使用有几点需要特别注意：</p><ul><li>stateless 组件上无法直接使用，因为stateless 组件无实例</li></ul><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token function">MyFunctionalComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>textInput <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 错误，无状态组件没有实例</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>MyFunctionalComponent ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>textInput<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ul><li>stateless 组件内部可以使用 ref</li></ul><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token function">CustomTextInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ref 需要在组件初始化就创建</span>
  <span class="token keyword">let</span> textInput <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 无状态组件内部可以创建ref</span>
    textInput<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input
        type<span class="token operator">=</span><span class="token string">"text"</span>
        ref<span class="token operator">=</span><span class="token punctuation">{</span>textInput<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>

      <span class="token operator">&lt;</span>input
        type<span class="token operator">=</span><span class="token string">"button"</span>
        value<span class="token operator">=</span><span class="token string">"Focus the text input"</span>
        onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><ul><li>innerRef 跨组件调用</li></ul><p>当我们需要在父组件上拿到子组件的 DOM 元素时，我们可以传递一个自定义 innerRef 直接从父组件上拿到子组件的 DOM 元素：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token function">CustomTextInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>innerRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">_setRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>inputElement <span class="token operator">=</span> el
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>CustomTextInput
        innerRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_setRef<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ul><li>ref 在 HOC 中传递</li></ul><p>ref 属性类似于 key, 本质是给 React 内部使用的，无法通过 props 进行传递。在 HOC 高阶组件内部，ref 往往不能正确获得内部实例，类似于 <a class=" " href="https://github.com/reduxjs/react-redux/blob/d769be59dafde13cee509185f1bab385b90dd9e7/src/components/connectAdvanced.js#L179-L189">react-redux 实现</a>，我们需要对组件增加 getWrappedInstance 和 setWrappedInstance 方法：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>    
    <span class="token comment">// 提供对外实例的方法</span>
    <span class="token function-variable function">getWrappedInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wrappedInstance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 实现 ref 的访问</span>
    <span class="token function-variable function">setWrappedInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>wrappedInstance <span class="token operator">=</span> ref<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>setWrappedInstance<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> HOCComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Wrap<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>App ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">comp</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 只能获取到 HOCComponent</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 通过中转后可以获取到 WrappedComponent</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comp<span class="token punctuation">.</span><span class="token function">getWrappedInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre><ul><li>穿云箭 React.forwardRef</li></ul><p>React 16 可以通过 React.forwardRef 更加方便地从父组件传递 ref 到子组件，<code>ForwardRef</code> 字面意思就是 <code>forward(传递)ref</code>。</p><p>我们对上面定义的 HOC 高阶组件做一个改造：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token constant">HOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>   
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>forwardRef<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent ref<span class="token operator">=</span><span class="token punctuation">{</span>forwardRef<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>HOCComponent forwardRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token constant">HOC</span><span class="token punctuation">(</span>Wrap<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>App ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">comp</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 此时就能直接拿到内部组件实例了</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre><h3 id="3-react-router-支持路由动态布局">3. React-Router 支持路由动态布局</h3><p>一个复杂的单页应用往往有不止一种 页面布局 展示，比如 A 页面布局是：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token operator">&lt;</span>Header<span class="token operator">></span>
  <span class="token operator">&lt;</span>Asider<span class="token operator">></span>
  <span class="token operator">&lt;</span>Main<span class="token operator">></span>
<span class="token operator">&lt;</span>Footer<span class="token operator">></span>
</code></pre><p>B 页面的布局是：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token operator">&lt;</span>Header<span class="token operator">></span>
  <span class="token operator">&lt;</span>Main<span class="token operator">></span>
<span class="token operator">&lt;</span>Footer<span class="token operator">></span>
</code></pre><p>我们希望实现根据页面路由自定义页面布局展现。</p><p>在单一页面布局下，我们通常是这么架构应用路由：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token operator">&lt;</span>Layout<span class="token operator">></span>
  <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
    <span class="token operator">&lt;</span>Route<span class="token operator">></span>
</code></pre><p>为了支持动态 <code>layout</code> 布局能力，就无法再沿用 <code>Layout</code> 嵌套 <code>Route</code> 来实现，我们希望能够实现 <code>Route</code> 嵌套 <code>Layout</code>：</p><p>类似于：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token operator">&lt;</span>Route <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>Layout <span class="token operator">/</span><span class="token operator">></span>
</code></pre><p>这样就可以实现动态路由布局能力了。</p><p><code>react-router</code> 提供了 <a class=" " href="https://reacttraining.com/react-router/web/api/Route/render-func">render</a> 方法来自定义<code>Route</code>组件。</p><p>对 Route 稍加改写就可以支持了：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">const</span> <span class="token function-variable function">BaseRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>component<span class="token operator">:</span> Component<span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>Route <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span> render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">matchProps</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>BaseLayout<span class="token operator">></span>
        <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span>matchProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>BaseLayout<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>于是我们在外部调用即可：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token operator">&lt;</span>Router<span class="token operator">></span>
  <span class="token operator">&lt;</span>Switch<span class="token operator">></span>
      <span class="token operator">&lt;</span>BaseRoute path<span class="token operator">=</span><span class="token string">'/guide'</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>QuickStart<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>WithoutSideBarRoute path<span class="token operator">=</span><span class="token string">'/demo'</span> exact component<span class="token operator">=</span><span class="token punctuation">{</span>Demo<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">'/guide'</span> <span class="token operator">/</span><span class="token operator">></span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span>
<span class="token operator">&lt;</span>Router<span class="token operator">></span>
</code></pre><p>这样我们就可以将<code>Router</code>和<code>Layout</code>组合起来，衍生出各种布局能力了。</p><h3 id="4-单页应用-pv-统计">4. 单页应用 PV 统计</h3><p>传统页面 PV 统计是基于页面之间链接跳转实现，但在单页应用里页内路由替代了请求新的页面，PV 统计只在应用初始化才会触发，这就意味着我们需要新的单页应用 PV 统计方案。</p><p>我们有两种方式来实现 PV 统计：</p><ol><li>监听 hashChange 变化上报 PV</li><li>基于 decorate 装饰 Route 组件，每次参数变更上报 PV</li></ol><p>第 1 种方案很好实现，在路由文件上侦听 hashChange 事件即可</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token function-variable function">hashChangeHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  ReactGA<span class="token punctuation">.</span><span class="token function">pageview</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>location<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>location<span class="token punctuation">.</span>search<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">componentDidMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hashChangeHandler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">componentWillUnmount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hashChangeHandler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>第二种方案的本质是当路由组件参数变更时，意味着此时路由 <code>path</code> 参数变更，直接监听 <code>componentWillReiveProps</code> 就能实现 PV 上报。我们需要一个装饰器方法将路由组件包装好。</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">const</span> <span class="token function-variable function">withRouter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>PureComponent <span class="token punctuation">{</span>
    <span class="token function-variable function">trackData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>location<span class="token punctuation">}</span> <span class="token operator">=</span> props
      <span class="token comment">// 上报PV</span>
      ReactGA<span class="token punctuation">.</span><span class="token function">pageview</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>location<span class="token punctuation">.</span>pathname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>location<span class="token punctuation">.</span>search<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidMount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 初始化也要上报PV</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trackData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentWillReceiveProps</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 每次路由参数变更上报PV</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trackData</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>在外面调用就很简单了，将 <code>BaseRoute</code> 包装一层即可。</p><pre><code>// ....BaseRoute 原有逻辑
export default withRouter()(BaseRoute)
</code></pre><h3 id="5-权限控制">5. 权限控制</h3><p>权限控制是中后台系统的核心功能之一，权限控制一般分为页面粒度和页面元素粒度。</p><p>当我们需要对页面元素粒度进行权限控制时，譬如我们需要页面上 button 按钮根据是否有权限，来控制展示或隐藏：</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>code<span class="token punctuation">,</span> resouceList<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
  <span class="token keyword">let</span> hasAuth <span class="token operator">=</span> resouceList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>hasAuth <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">创建用户</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>一个元素这么写当然没问题，但是如果有 10 个元素需要加权限控制，或者按钮的显示逻辑修改了呢，我们需要一个更加通用的解决办法。</p><p>我们可以创建一个组件容器组件专门负责管理权限：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token function">AuthContainer</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> resourceList<span class="token punctuation">,</span> children<span class="token punctuation">,</span> code <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hasAuth <span class="token operator">=</span> resourceList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
  <span class="token keyword">return</span> hasAuth <span class="token operator">&amp;&amp;</span> children
<span class="token punctuation">}</span>
</code></pre><p>然后将上面的组件改写一下：</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>code<span class="token punctuation">,</span> resouceList<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>AuthContainer code<span class="token operator">=</span><span class="token punctuation">{</span>code<span class="token punctuation">}</span> resouceList<span class="token operator">=</span><span class="token punctuation">{</span>resouceList<span class="token punctuation">}</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>button<span class="token operator">></span>创建用户<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AuthContainer<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>重构完的代码无论是从语义性，还是扩展性都有很大的提升。</p><h3 id="6-currying-react">6. currying React</h3><p>currying 柯里化是函数式语言基础的写法，通俗化来说就是把多个参数的函数变换成接受一个个单一参数的函数，并且在最后返回新函数。</p><p>也广泛应用在 React 及其周边库的写法中，像常用<code>react-redux</code> 中 <code>connect(mapStateToProps, mapDispatchToProps)(App)</code> 就是标准的柯里化写法。</p><p>以下举个栗子来阐释柯里化在 React 开发中的实践：</p><ul><li>多个过滤条件合并</li></ul><p>现在有一个case，我们分别需要针对 price、age、brand 三个维度过滤筛选产品列表</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token comment">// 通常实现</span>
<span class="token keyword">class</span> <span class="token class-name">Filters</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// 更新价格条件</span>
  <span class="token function-variable function">updatePriceFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">selectionsChanged</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>filterSelections<span class="token punctuation">,</span>
      price<span class="token operator">:</span> newValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 更新年龄条件</span>
  <span class="token function-variable function">updateAgeFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">selectionsChanged</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>filterSelections<span class="token punctuation">,</span>
      ages<span class="token operator">:</span> newValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 更新品牌条件</span>
  <span class="token function-variable function">updateBrandFilter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">selectionsChanged</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>filterSelections<span class="token punctuation">,</span>
      brands<span class="token operator">:</span> newValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>PriceFilter 
          priceChanged<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>updatePriceFilter<span class="token punctuation">}</span> 
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>AgeFilter 
          agesChanged<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateAgeFilter<span class="token punctuation">}</span> 
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>BrandFilter 
          brandsChanged<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>updateBrandFilter<span class="token punctuation">}</span> 
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>我们发现，三个过滤方法除了过滤条件不一样，其他代码逻辑几乎一样，如果后续再增加一个过滤条件，我们几乎是需要再拷贝一遍代码，这不科学。</p><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers=""><span class="token comment">// 柯里化实现</span>
<span class="token keyword">class</span> <span class="token class-name">Filters</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">// 合并过滤条件</span>
  <span class="token function-variable function">updateSelections</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selectionType</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">selectionsChanged</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>filterSelections<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>selectionType<span class="token punctuation">]</span><span class="token operator">:</span> newValue<span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>PriceFilter 
          priceChanged<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSelections</span><span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> 
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>AgeFilter 
          agesChanged<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSelections</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> 
        <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>BrandFilter 
          brandsChanged<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSelections</span><span class="token punctuation">(</span><span class="token string">'brand'</span><span class="token punctuation">)</span><span class="token punctuation">}</span> 
        <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>很明显，柯里化改造后的代码大大简化了代码逻辑，也增强后续扩展性。</p><blockquote><blockquote><p>更新 </p></blockquote><p>目前这种实现方式，还是会导致每次重新创建匿名方法，应该通过如下方式，才能避免文中所说的匿名方法重复创建问题：</p><p>updateSelectionsPrice = updateSelections(’price’)</p><p>updateSelectionsAge = updateSelections(’age’)</p><p>updateSelectionsBrand = updateSelections(’brand’)</p></blockquote><h3 id="7-recompose-让生活更美好">7. recompose 让生活更美好</h3><p><a class=" " href="https://github.com/acdlite/recompose/blob/master/docs/API.md">recompose</a> 是一个优秀的 React 社区开源库，提供了一系列小而美的高阶组件和工具类方法，可以看成是 React 的 lodash。</p><ul><li>pure：可以将函数式组件实现 PureComponent 的能力，减少重复渲染</li><li>withProps: 给组件添加属性，譬如可以将当前页面的路由信息、一些需要计算的信息作为属性注入到组件</li><li>withPropsOnChange: 类似于withProps, 当时只有当传入组件发生变更才会重新计算属性注入到组件中</li><li>defaultProps：添加默认属性（常用于公共属性的提取和添加）</li><li>setPropTypes：设置属性类型（常用于公共属性设置）</li><li>compose：将多个高阶组件组合起来</li></ul><pre><code class="language-javascript" data-language="javascript" data-highlighted-line-numbers="">composedHoc <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>hoc1<span class="token punctuation">,</span> hoc2<span class="token punctuation">,</span> hoc3<span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token comment">// 实际上等于</span>
<span class="token function">hoc1</span><span class="token punctuation">(</span><span class="token function">hoc2</span><span class="token punctuation">(</span><span class="token function">hoc3</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>希望 recompose 同样能够成为你开发的得力助手。</p></div><footer class="BlogPostLayout_footer__1TyyS"><h3 class="BlogPostLayout_title__j9S_E"><a class=" " href="/">qingtong Blog</a></h3><div class="
      Bio_Bio__iDVYA
      BlogPostLayout_bio__2WXr0
    "><img src="https://www.gravatar.com/avatar/aa99b351245441b8ca95d54a52d2998c.jpg?s=56&amp;d=identicon" alt="Me"/><p>来自接地气的一线实践开发经验，用心做原创<br/>分享关于 React、数据可视化、效率工具等，打造专业前端知识库</p></div><section class="BlogPostLayout_links__1fL9M"><a class=" " href="/posts/2018-12-28/react-element/">← <!-- -->React 类型探究</a><a class="BlogPostLayout_next__1lwtu " href="/posts/2018-05-17/redux-best-practice/">redux 最佳实践<!-- --> →</a></section></footer></article></main></div></div><script>!function(u){function e(e){for(var t,r,n=e[0],o=e[1],c=e[2],a=0,f=[];a<n.length;a++)r=n[a],l[r]&&f.push(l[r][0]),l[r]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(u[t]=o[t]);for(p&&p(e);f.length;)f.shift()();return d.push.apply(d,c||[]),i()}function i(){for(var e,t=0;t<d.length;t++){for(var r=d[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==l[c]&&(n=!1)}n&&(d.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},f={19:0},l={19:0},d=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return u[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(d){var e=[];f[d]?e.push(f[d]):0!==f[d]&&{1:1,10:1,17:1}[d]&&e.push(f[d]=new Promise(function(e,n){for(var t="static/css/"+({}[d]||d)+"."+{1:"49edd35f",2:"31d6cfe0",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"31d6cfe0",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"60612b0d",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"31d6cfe0",15:"31d6cfe0",16:"31d6cfe0",17:"3f23591b"}[d]+".chunk.css",o=s.p+t,r=document.getElementsByTagName("link"),c=0;c<r.length;c++){var a=(u=r[c]).getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(a===t||a===o))return e()}var f=document.getElementsByTagName("style");for(c=0;c<f.length;c++){var u;if((a=(u=f[c]).getAttribute("data-href"))===t||a===o)return e()}var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onload=e,i.onerror=function(e){var t=e&&e.target&&e.target.src||o,r=new Error("Loading CSS chunk "+d+" failed.\n("+t+")");r.request=t,n(r)},i.href=o,document.getElementsByTagName("head")[0].appendChild(i)}).then(function(){f[d]=0}));var r=l[d];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=l[d]=[e,t]});e.push(r[2]=t);var n,o=document.getElementsByTagName("head")[0],c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=s.p+"static/js/"+({}[d]||d)+"."+{1:"59852cbf",2:"759e1229",3:"734ff8ec",4:"f4c19758",5:"dd9b6e1d",6:"53817a86",7:"12fcb63d",8:"3e68a479",9:"78334f37",10:"c63f6356",11:"6d2761c2",12:"1b87128d",13:"3909f04c",14:"2e0f157e",15:"6b07a969",16:"57848b14",17:"fe2dd3b4"}[d]+".chunk.js",n=function(e){c.onerror=c.onload=null,clearTimeout(a);var t=l[d];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,o=new Error("Loading chunk "+d+" failed.\n("+r+": "+n+")");o.type=r,o.request=n,t[1](o)}l[d]=void 0}};var a=setTimeout(function(){n({type:"timeout",target:c})},12e4);c.onerror=c.onload=n,o.appendChild(c)}return Promise.all(e)},s.m=u,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/blog/",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var p=n;i()}([])</script><script src="/blog/static/js/18.c7bca5f2.chunk.js"></script><script src="/blog/static/js/main.ff93a746.chunk.js"></script></body></html>