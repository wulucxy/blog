<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="shortcut icon" href="/blog/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/blog/manifest.json"><link rel="canonical" href="/blog/posts/2020-02-19/table-search-design/" />

    <title data-react-helmet="true">查询 + Table 组件设计</title>
    
    
  <link rel="stylesheet" href="/blog/static/css/1.256ccf89.chunk.css" /><link href="/blog/static/css/main.e5a51191.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__8wf6g"><div class="
        LoadingIndicator_LoadingIndicator__nj5Ug
        
        undefined
      "></div><header><h3 class="BlogLayout_title__1KtpA"><a class=" " href="/">qingtong Blog</a></h3></header><main><article><header class="BlogPostLayout_header__30yid"><h1 class="BlogPostLayout_title__1TCtk"><a class=" " href="/posts/2020-02-19/table-search-design/">查询 + Table 组件设计</a></h1><small><time dateTime="Tue, 18 Feb 2020 16:00:00 GMT">February 19, 2020</time> <!-- -->•<!-- --> <ul class="ArticleMeta_tags__3omzx"><li><a class=" " href="/tags/design/">design</a></li></ul> <!-- -->•<!-- --> <span>☕️<!-- --> <!-- -->6<!-- --> min read</span></small></header><div class="BlogPostLayout_content__1Z4m-"><h3 id="背景--目标">背景 &amp; 目标</h3><p>中后台系统的页面中多是查询+表格的展现形式，为了提高开发效率，减少重复的模版代码的书写，将公共能力收拢到组件，方便用户快速构建页面。</p><h3 id="产品现状">产品现状</h3><p>省略，参考自身业务</p><h3 id="产品要点梳理">产品要点梳理</h3><ol><li><p>查询和表格通常是一一对应，<strong>同时出现</strong> 的，也有场景是 <strong>只有表格，没有查询</strong> 。只有查询，没有表格目前系统很少见（<em>如果有的话，请帮忙补充</em>）。</p></li><li><p>查询组件只涉及到查询功能，不涉及到数据的更新操作，支持1个或多个数据共同查询，<strong>查询字段通常来源于表格字段</strong>，当然也开放自定义字段配置。</p></li><li><p>查询组件需要按列布局，也要支持<strong>展开/收缩</strong>，查询条件可以指定顺序，也可以默认按照表格列的顺序按先后放置，目前查询操作仅限于<strong>查询</strong>和<strong>重置</strong>。</p></li><li><p>表格组件<strong>数据源是动态</strong>的，需要通过查询条件向服务端发起请求，查询条件来自于<strong>查询组件</strong>，服务端请求需要做<strong>竞态处理（onLoad, onRequestError）</strong>，初始请求需要 <code>loading</code> 标识，查询参数来自于查询组件，以及自定义参数组合而成。</p></li><li><p>表格组件展示很灵活，包括 <strong>Title</strong>, <strong>ToolBar</strong>，并且表格组件通常会带有<strong>弹窗操作</strong>，弹窗需要获取当前 <strong>record</strong> 数据，操作完毕需要更新 Table。<code>ToolBar</code> 需要提供全局操作来更新表格（刷新）。</p></li><li><p>表格组件分页操作比较固定，每次查询重置当前页码，<code>page</code> 和 <code>pageSize</code> 变更重新发起请求，这一块公共逻辑需要统一封装，自定义的诉求比较少。</p></li><li><p>表格列组件有很多常见的开发情景：<strong>超出宽度文本<code>ellipsis</code></strong>，<strong>支持文本复制</strong>，<strong>字符filter（金额、时间、日期）</strong>，<strong>枚举状态处理</strong> 等等。列组件配置可以直接复用到查询表单组件上。</p></li></ol><h3 id="技术设计">技术设计</h3><p><code>List</code> 基于 Antd Table 进行扩展，封装了一些常用的 UI 和行为，通过将查询组件和 Table 组合起来，提供给用户一套标准化的组件实现。</p><h4 id="整体架构">整体架构</h4><p><img src="https://github.com/wulucxy/blog/raw/master/src/routes/posts/2020-02-19-table-search-design/image/arc.png" alt="list_设计"/></p><h4 id="组件-展示">组件 展示</h4><p><img src="https://github.com/wulucxy/blog/raw/master/src/routes/posts/2020-02-19-table-search-design/image/ui.png" alt="image"/></p><h4 id="api-设计">api 设计</h4><blockquote><p>该组件基于 <code>Antd Table</code> 扩展，默认支持 Table 所有属性，并且扩展下列其他属性：</p></blockquote><ul><li><p>应用实例</p><ul><li>actionRef：返回应用实例，对外提供公共方法，比如 refresh 等</li><li>formRef：查询表单实例</li><li>showSearch: 不展示查询栏，默认为 false</li></ul></li><li><p>数据请求</p><ul><li>request：返回一个 promise</li><li>params: 请求参数</li><li>onLoad: 每次请求完毕触发</li><li>onRequestError: 请求异常触发回调</li></ul></li><li><p>UI 展示</p><ul><li>Title：表格标题，支持 string 或者 ReactNode</li><li>ToolBar:  自动以工具栏组件，位于标题右侧</li><li>pagination: 继承 Table pagination，封装 page 和 pageSize 能力</li></ul></li><li><p>配置</p><ul><li>提供 columns 作为表格列和查询表单字段</li></ul><pre><code>key,
dataIndex,
width,
render,
valueType: 封装一些常见的类型filter，比如 dateTime, money 等
hideInSearch: 查询组件字段是否展示，默认为true
hideInTable: 不展示在Table 列，默认为 fasle
enum: 枚举类字段，比如状态（新建，已发布，已暂停等）
copy: 是否支持拷贝
ellipsis: 文本溢出自动展示
renderSearchItem:SearchItem 自定义展示
searchItemProps: SearchItem 配置
sort: 查询表单展示优先级
span: 表单项自定义宽度，优先于 searchConfig.span 执行
</code></pre></li><li><p>查询表单配置</p><ul><li>onSearch: 查询表单提交触发</li><li>onRest: 重置查询条件</li><li>searchConfig: 查询表单配置<ul><li>span: 列宽度，默认为8，参考 <code>antd cols</code></li><li>isCollpase: 当多行分布时是否折叠，默认为 <code>true</code></li><li>collpaseRows: 2, 最多未折叠展示行数</li><li>searchText: 搜索文本，默认<code>搜索</code></li><li>resetText: 重置文本，默认 <code>重置</code></li><li>collapseRender: 展开/收起 自定义渲染</li><li>needParamsToUrl：查询完毕更新 url，默认<code>false</code></li></ul></li></ul></li></ul><h4 id="列渲染逻辑">列渲染逻辑</h4><p><img src="https://github.com/wulucxy/blog/raw/master/src/routes/posts/2020-02-19-table-search-design/image/columnByTable.png" alt="column"/></p><h4 id="查询表单渲染逻辑">查询表单渲染逻辑</h4><p><img src="https://github.com/wulucxy/blog/raw/master/src/routes/posts/2020-02-19-table-search-design/image/columnBySearch.png" alt="查询表单渲染逻辑"/></p><h4 id="valuetype-设计">valueType 设计</h4><table><thead><tr><th>valueType</th><th>说明</th><th>搜索组件</th><th>Table</th><th>search</th></tr></thead><tbody><tr><td>money</td><td>金额千分符处理</td><td>InputNumber</td><td>✓</td><td>✓</td></tr><tr><td>date</td><td>日期处理</td><td>DatePicker</td><td>✓</td><td>✓</td></tr><tr><td>dateTime</td><td>日期+时间</td><td>DatePicker(showTime)</td><td>✓</td><td>✓</td></tr><tr><td>time</td><td>时间</td><td>TimePicker</td><td>✓</td><td>✓</td></tr><tr><td>dateRange</td><td>日期区间</td><td>RangePicker</td><td></td><td>✓</td></tr><tr><td>dateTimeRange</td><td>日期时间区间</td><td>RangePicker(showTime)</td><td></td><td>✓</td></tr><tr><td>checkbox</td><td>多选表单组件</td><td>checkbox</td><td></td><td>✓</td></tr><tr><td>radio</td><td>单选组件</td><td>radio</td><td></td><td>✓</td></tr><tr><td>inputNumber</td><td>数字输入组件</td><td>InputNumber</td><td></td><td>✓</td></tr><tr><td>textarea</td><td>文本域组件</td><td>TextArea</td><td></td><td>✓</td></tr></tbody></table></div><footer class="BlogPostLayout_footer__1DZxO"><h3 class="BlogPostLayout_title__1TCtk"><a class=" " href="/">qingtong Blog</a></h3><div class="
      Bio_Bio__1xPtR
      BlogPostLayout_bio__vsFE-
    "><img src="https://www.gravatar.com/avatar/aa99b351245441b8ca95d54a52d2998c.jpg?s=56&amp;d=identicon" alt="Me"/><p>来自接地气的一线实践开发经验，用心做原创<br/>分享关于低代码、数据可视化、效率工具等，打造专业前端知识库</p></div><section class="BlogPostLayout_links__LI8RB"><a class=" " href="/posts/2020-03-07/welcome/">← <!-- -->welcome</a><a class="BlogPostLayout_next__qd2f_ " href="/posts/2019-08-01/typescript-redux/">大型项目 typescript + redux 实践<!-- --> →</a></section></footer></article></main></div></div><script>!function(u){function e(e){for(var t,r,n=e[0],o=e[1],c=e[2],a=0,f=[];a<n.length;a++)r=n[a],l[r]&&f.push(l[r][0]),l[r]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(u[t]=o[t]);for(p&&p(e);f.length;)f.shift()();return i.push.apply(i,c||[]),d()}function d(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==l[c]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},f={27:0},l={27:0},i=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return u[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(i){var e=[];f[i]?e.push(f[i]):0!==f[i]&&{1:1,14:1,21:1}[i]&&e.push(f[i]=new Promise(function(e,n){for(var t="static/css/"+({}[i]||i)+"."+{1:"256ccf89",2:"31d6cfe0",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"31d6cfe0",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"eb339734",15:"31d6cfe0",16:"31d6cfe0",17:"31d6cfe0",18:"31d6cfe0",19:"31d6cfe0",20:"31d6cfe0",21:"af8fefa4",22:"31d6cfe0",23:"31d6cfe0",24:"31d6cfe0",25:"31d6cfe0"}[i]+".chunk.css",o=s.p+t,r=document.getElementsByTagName("link"),c=0;c<r.length;c++){var a=(u=r[c]).getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(a===t||a===o))return e()}var f=document.getElementsByTagName("style");for(c=0;c<f.length;c++){var u;if((a=(u=f[c]).getAttribute("data-href"))===t||a===o)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var t=e&&e.target&&e.target.src||o,r=new Error("Loading CSS chunk "+i+" failed.\n("+t+")");r.request=t,n(r)},d.href=o,document.getElementsByTagName("head")[0].appendChild(d)}).then(function(){f[i]=0}));var r=l[i];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=l[i]=[e,t]});e.push(r[2]=t);var n,o=document.getElementsByTagName("head")[0],c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=s.p+"static/js/"+({}[i]||i)+"."+{1:"9cf5b42e",2:"eaf673cb",3:"6888bba0",4:"d2a7707a",5:"6ab795cc",6:"65947da0",7:"dedb6494",8:"a2ed3c61",9:"1c7896e9",10:"87ace4b5",11:"70945193",12:"a49b4820",13:"c2f91851",14:"29f37b8e",15:"10420619",16:"d5004db3",17:"e1882e9d",18:"89f2a483",19:"05bf0fe7",20:"2b184264",21:"54d0e0eb",22:"c8454142",23:"9b1164ac",24:"582f6c46",25:"b06ef97a"}[i]+".chunk.js",n=function(e){c.onerror=c.onload=null,clearTimeout(a);var t=l[i];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,o=new Error("Loading chunk "+i+" failed.\n("+r+": "+n+")");o.type=r,o.request=n,t[1](o)}l[i]=void 0}};var a=setTimeout(function(){n({type:"timeout",target:c})},12e4);c.onerror=c.onload=n,o.appendChild(c)}return Promise.all(e)},s.m=u,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/blog/",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var p=n;d()}([])</script><script src="/blog/static/js/26.62626c06.chunk.js"></script><script src="/blog/static/js/main.ed1deede.chunk.js"></script></body></html>